program test_geom
use no_pfunit
use m_geoutils
implicit none
   integer :: i,j
   real   :: x,y, x1, y1, x2, y2
   integer, parameter :: nj=20, ni=20
   real   :: lon, lat
   real   :: lats(nj), lons(nj), xlam(nj), ylam(nj)
   integer :: its(nj)
   character(len=*), parameter :: fmt = '(a,1p,100(g13.7,'',''))'
   real,   parameter:: ylam_ref(nj,ni) = reshape( (/ &
        3041.643, 3156.865, 3272.074, 3387.240, 3502.330, 3617.315, 3732.163, 3846.843, 3961.321, 4075.567, 4189.547, 4303.226, 4416.569, 4529.541, 4642.103, 4754.215, 4865.835, 4976.917, 5087.413, 5197.267, &
        3032.746, 3147.976, 3263.198, 3378.383, 3493.502, 3608.524, 3723.421, 3838.163, 3952.717, 4067.056, 4181.146, 4294.959, 4408.461, 4521.623, 4634.408, 4746.783, 4858.715, 4970.166, 5081.092, 5191.456, &
        3023.849, 3139.075, 3254.299, 3369.491, 3484.623, 3599.667, 3714.593, 3829.373, 3943.978, 4058.379, 4172.548, 4286.455, 4400.073, 4513.371, 4626.322, 4738.896, 4851.064, 4962.794, 5074.055, 5184.816, &
        3014.956, 3130.167, 3245.380, 3360.564, 3475.694, 3590.740, 3705.674, 3820.468, 3935.095, 4049.526, 4163.734, 4277.694, 4391.377, 4504.756, 4617.807, 4730.501, 4842.815, 4954.721, 5066.195, 5177.211, &
        3006.067, 3121.253, 3236.442, 3351.605, 3466.715, 3581.743, 3696.663, 3811.446, 3926.064, 4040.491, 4154.700, 4268.665, 4382.359, 4495.757, 4608.834, 4721.564, 4833.925, 4945.891, 5057.441, 5168.551, &
        2997.188, 3112.337, 3227.489, 3342.616, 3457.689, 3572.680, 3687.562, 3802.307, 3916.886, 4031.274, 4145.443, 4259.366, 4373.017, 4486.368, 4599.396, 4712.075, 4824.378, 4936.283, 5047.765, 5158.799, &
        2988.321, 3103.423, 3218.525, 3333.600, 3448.619, 3563.554, 3678.376, 3793.057, 3907.568, 4021.881, 4135.970, 4249.803, 4363.355, 4476.598, 4589.503, 4702.043, 4814.189, 4925.914, 5037.186, 5147.977, &
        2979.468, 3094.511, 3209.552, 3324.562, 3439.512, 3554.372, 3669.112, 3783.704, 3898.118, 4012.323, 4126.292, 4239.993, 4353.396, 4466.469, 4579.183, 4691.503, 4803.397, 4914.831, 5025.767, 5136.165, &
        2970.635, 3085.610, 3200.578, 3315.509, 3430.373, 3545.140, 3659.779, 3774.260, 3888.549, 4002.618, 4116.433, 4229.960, 4343.167, 4456.018, 4568.479, 4680.510, 4792.071, 4903.120, 5013.611, 5123.491, &
        2961.823, 3076.721, 3191.605, 3306.445, 3421.211, 3535.870, 3650.389, 3764.738, 3878.881, 3992.785, 4106.415, 4219.735, 4332.708, 4445.292, 4557.448, 4669.132, 4780.296, 4890.887, 5000.850, 5110.120, &
        2953.036, 3067.848, 3182.640, 3297.379, 3412.034, 3526.571, 3640.956, 3755.155, 3869.131, 3982.849, 4096.270, 4209.355, 4322.060, 4434.344, 4546.157, 4657.452, 4768.170, 4878.253, 4987.633, 5096.236, &
        2944.278, 3058.996, 3173.687, 3288.317, 3402.850, 3517.255, 3631.493, 3745.529, 3859.323, 3972.838, 4086.031, 4198.859, 4311.275, 4423.233, 4534.679, 4645.555, 4755.801, 4865.346, 4974.118, 5082.028, &
        2935.548, 3050.168, 3164.752, 3279.264, 3393.670, 3507.933, 3622.014, 3735.876, 3849.478, 3962.777, 4075.729, 4188.288, 4300.402, 4412.020, 4523.083, 4633.530, 4743.292, 4852.293, 4960.452, 5067.676, &
        2926.850, 3041.368, 3155.839, 3270.229, 3384.501, 3498.616, 3612.535, 3726.217, 3839.618, 3952.695, 4065.399, 4177.681, 4289.488, 4400.761, 4511.440, 4621.458, 4730.742, 4839.210, 4946.777, 5053.344, &
        2918.184, 3032.596, 3146.952, 3261.217, 3375.350, 3489.314, 3603.066, 3716.564, 3829.763, 3942.615, 4055.071, 4167.077, 4278.578, 4389.512, 4499.814, 4609.416, 4718.240, 4826.202, 4933.212, 5039.172, &
        2909.550, 3023.854, 3138.093, 3252.229, 3366.224, 3480.035, 3593.621, 3706.936, 3819.932, 3932.562, 4044.772, 4156.509, 4267.711, 4378.318, 4488.261, 4597.468, 4705.860, 4813.353, 4919.855, 5025.266, &
        2900.947, 3015.141, 3129.263, 3243.271, 3357.127, 3470.787, 3584.207, 3697.341, 3810.140, 3922.553, 4034.527, 4146.003, 4256.923, 4367.220, 4476.826, 4585.667, 4693.665, 4800.732, 4906.781, 5011.712, &
        2892.372, 3006.457, 3120.461, 3234.344, 3348.062, 3461.574, 3574.833, 3687.791, 3800.400, 3912.606, 4024.353, 4135.585, 4246.239, 4356.249, 4465.545, 4574.056, 4681.699, 4788.391, 4894.045, 4998.564, &
        2883.821, 2997.798, 3111.687, 3225.445, 3339.031, 3452.398, 3565.502, 3678.292, 3790.719, 3902.729, 4014.265, 4125.270, 4235.679, 4345.428, 4454.446, 4562.660, 4669.993, 4776.362, 4881.680, 4985.857, &
        2875.288, 2989.160, 3102.937, 3216.575, 3330.031, 3443.261, 3556.216, 3668.848, 3781.104, 3892.931, 4004.272, 4115.068, 4225.257, 4334.771, 4443.543, 4551.500, 4658.566, 4764.660, 4869.703, 4973.604  &
      /), (/ nj, ni/) )
   real,   parameter:: xlam_ref(nj,ni) = reshape( (/ &
        3416.052, 3423.235, 3430.538, 3437.962, 3445.506, 3453.171, 3460.956, 3468.862, 3476.889, 3485.039, 3493.312, 3501.708, 3510.229, 3518.877, 3527.653, 3536.560, 3545.599, 3554.773, 3564.083, 3573.532, &
        3556.294, 3563.482, 3570.780, 3578.189, 3585.707, 3593.335, 3601.073, 3608.919, 3616.875, 3624.941, 3633.117, 3641.405, 3649.805, 3658.319, 3666.949, 3675.696, 3684.564, 3693.556, 3702.675, 3711.926, &
        3696.728, 3703.922, 3711.217, 3718.611, 3726.104, 3733.695, 3741.383, 3749.168, 3757.050, 3765.028, 3773.102, 3781.273, 3789.541, 3797.906, 3806.371, 3814.936, 3823.604, 3832.376, 3841.258, 3850.252, &
        3837.305, 3844.506, 3851.798, 3859.178, 3866.645, 3874.198, 3881.836, 3889.558, 3897.362, 3905.247, 3913.214, 3921.260, 3929.386, 3937.591, 3945.875, 3954.237, 3962.679, 3971.202, 3979.806, 3988.495, &
        3977.975, 3985.184, 3992.472, 3999.837, 4007.278, 4014.792, 4022.378, 4030.034, 4037.758, 4045.548, 4053.402, 4061.318, 4069.295, 4077.330, 4085.421, 4093.567, 4101.766, 4110.016, 4118.315, 4126.663, &
        4118.689, 4125.905, 4133.189, 4140.539, 4147.952, 4155.426, 4162.958, 4170.547, 4178.188, 4185.880, 4193.618, 4201.401, 4209.224, 4217.083, 4224.977, 4232.898, 4240.845, 4248.812, 4256.793, 4264.784, &
        4259.397, 4266.619, 4273.898, 4281.230, 4288.615, 4296.047, 4303.525, 4311.044, 4318.602, 4326.193, 4333.814, 4341.462, 4349.130, 4356.813, 4364.508, 4372.206, 4379.901, 4387.586, 4395.253, 4402.892, &
        4400.051, 4407.277, 4414.548, 4421.862, 4429.215, 4436.604, 4444.025, 4451.475, 4458.947, 4466.438, 4473.942, 4481.455, 4488.970, 4496.481, 4503.980, 4511.461, 4518.915, 4526.332, 4533.702, 4541.013, &
        4540.601, 4547.827, 4555.088, 4562.381, 4569.702, 4577.045, 4584.409, 4591.786, 4599.173, 4606.563, 4613.952, 4621.333, 4628.699, 4636.043, 4643.357, 4650.633, 4657.861, 4665.031, 4672.133, 4679.156, &
        4680.998, 4688.222, 4695.470, 4702.738, 4710.023, 4717.319, 4724.622, 4731.927, 4739.228, 4746.519, 4753.793, 4761.046, 4768.269, 4775.454, 4782.594, 4789.680, 4796.704, 4803.655, 4810.524, 4817.303, &
        4821.193, 4828.411, 4835.642, 4842.882, 4850.128, 4857.374, 4864.614, 4871.845, 4879.059, 4886.250, 4893.414, 4900.542, 4907.626, 4914.662, 4921.641, 4928.554, 4935.395, 4942.155, 4948.828, 4955.408, &
        4961.140, 4968.346, 4975.556, 4982.764, 4989.967, 4997.158, 5004.333, 5011.487, 5018.613, 5025.706, 5032.758, 5039.764, 5046.718, 5053.611, 5060.439, 5067.195, 5073.873, 5080.469, 5086.978, 5093.399, &
        5100.792, 5107.981, 5115.164, 5122.334, 5129.489, 5136.622, 5143.728, 5150.802, 5157.837, 5164.829, 5171.771, 5178.657, 5185.482, 5192.241, 5198.928, 5205.538, 5212.069, 5218.520, 5224.891, 5231.185, &
        5240.104, 5247.270, 5254.418, 5261.545, 5268.646, 5275.715, 5282.746, 5289.736, 5296.677, 5303.565, 5310.396, 5317.162, 5323.860, 5330.486, 5337.037, 5343.509, 5349.904, 5356.223, 5362.470, 5368.655, &
        5379.030, 5386.166, 5393.274, 5400.351, 5407.390, 5414.388, 5421.339, 5428.238, 5435.081, 5441.861, 5448.576, 5455.219, 5461.789, 5468.282, 5474.697, 5481.034, 5487.296, 5493.487, 5499.616, 5505.696, &
        5517.530, 5524.627, 5531.687, 5538.704, 5545.676, 5552.595, 5559.458, 5566.259, 5572.996, 5579.662, 5586.254, 5592.770, 5599.207, 5605.562, 5611.838, 5618.036, 5624.161, 5630.220, 5636.226, 5642.195, &
        5655.562, 5662.611, 5669.614, 5676.564, 5683.457, 5690.289, 5697.055, 5703.751, 5710.373, 5716.917, 5723.379, 5729.758, 5736.053, 5742.263, 5748.391, 5754.441, 5760.419, 5766.335, 5772.204, 5778.043, &
        5793.088, 5800.081, 5807.016, 5813.889, 5820.694, 5827.429, 5834.088, 5840.668, 5847.165, 5853.575, 5859.897, 5866.129, 5872.271, 5878.325, 5884.292, 5890.180, 5895.995, 5901.750, 5907.460, 5913.145, &
        5930.071, 5936.997, 5943.854, 5950.639, 5957.347, 5963.974, 5970.515, 5976.967, 5983.327, 5989.593, 5995.762, 6001.834, 6007.810, 6013.690, 6019.481, 6025.189, 6030.821, 6036.392, 6041.917, 6047.415, &
        6066.478, 6073.325, 6080.094, 6086.780, 6093.378, 6099.885, 6106.296, 6112.609, 6118.820, 6124.927, 6130.929, 6136.827, 6142.619, 6148.311, 6153.906, 6159.413, 6164.839, 6170.198, 6175.507, 6180.786  &
      /), (/ nj, ni/) )
   real,   parameter :: lon_ref(nj,ni) = reshape( (/ &
       -2.659927,-2.838398,-3.026286,-3.224301,-3.433229,-3.653934,-3.887375,-4.134614,-4.396836,-4.675361,-4.971667,-5.287416,-5.624472,-5.984947,-6.371230,-6.786043,-7.232486,-7.714108,-8.235001,-8.799869, &
       -.7076995,-.8435701,-.9866635,-1.137533,-1.296787,-1.465099,-1.643218,-1.831978,-2.032302,-2.245234,-2.471937,-2.713722,-2.972077,-3.248678,-3.545442,-3.864558,-4.208536,-4.580265,-4.983105,-5.420957, &
        1.254509, 1.162035, 1.064618,0.9618765,0.8533893,0.7386910,0.6172615,0.4885243,0.3518332,0.2064650,5.1605534E-02,-.1136625,-.2903814,-.4797336,-.6830726,-.9019471,-1.138147,-1.393739,-1.671137,-1.973163, &
        3.223544, 3.175014, 3.123882, 3.069946, 3.012981, 2.952742, 2.888951, 2.821305, 2.749456, 2.673023, 2.591571, 2.504607, 2.411577, 2.311847, 2.204690, 2.089271, 1.964626, 1.829636, 1.682991, 1.523149, &
        5.196170, 5.191876, 5.187351, 5.182577, 5.177536, 5.172204, 5.166556, 5.160567, 5.154205, 5.147436, 5.140223, 5.132519, 5.124276, 5.115439, 5.105942, 5.095709, 5.084656, 5.072682, 5.059669, 5.045479, &
        7.169116, 7.209082, 7.251192, 7.295613, 7.342530, 7.392145, 7.444685, 7.500404, 7.559586, 7.622546, 7.689645, 7.761287, 7.837931, 7.920099, 8.008393, 8.103501, 8.206222, 8.317478, 8.438356, 8.570129, &
        9.139101, 9.223089, 9.311569, 9.404891, 9.503434, 9.607628, 9.717939, 9.834900, 9.959094, 10.09118, 10.23191, 10.38211, 10.54273, 10.71485, 10.89972, 11.09874, 11.31355, 11.54604, 11.79843, 12.07330, &
        11.10288, 11.23039, 11.36469, 11.50629, 11.65578, 11.81378, 11.98100, 12.15823, 12.34633, 12.54630, 12.75922, 12.98635, 13.22908, 13.48899, 13.76791, 14.06791, 14.39135, 14.74100, 15.12004, 15.53217, &
        13.05729, 13.22757, 13.40685, 13.59582, 13.79521, 14.00587, 14.22871, 14.46475, 14.71513, 14.98111, 15.26413, 15.56577, 15.88783, 16.23235, 16.60163, 16.99829, 17.42534, 17.88622, 18.38488, 18.92590, &
        14.99925, 15.21132, 15.43450, 15.66961, 15.91757, 16.17938, 16.45615, 16.74912, 17.05964, 17.38924, 17.73961, 18.11265, 18.51049, 18.93552, 19.39045, 19.87833, 20.40263, 20.96730, 21.57684, 22.23640, &
        16.92583, 17.17849, 17.44423, 17.72402, 18.01891, 18.33005, 18.65872, 19.00633, 19.37444, 19.76476, 20.17922, 20.61996, 21.08936, 21.59009, 22.12514, 22.69787, 23.31205, 23.97196, 24.68239, 25.44880, &
        18.83428, 19.12612, 19.43289, 19.75565, 20.09558, 20.45395, 20.83218, 21.23182, 21.65458, 22.10235, 22.57720, 23.08146, 23.61769, 24.18874, 24.79778, 25.44833, 26.14435, 26.89021, 27.69083, 28.55167, &
        20.72200, 21.05147, 21.39754, 21.76136, 22.14422, 22.54750, 22.97270, 23.42149, 23.89569, 24.39731, 24.92853, 25.49178, 26.08974, 26.72534, 27.40183, 28.12281, 28.89223, 29.71445, 30.59427, 31.53699, &
        22.58665, 22.95202, 23.33550, 23.73833, 24.16184, 24.60750, 25.07689, 25.57175, 26.09396, 26.64560, 27.22893, 27.84642, 28.50078, 29.19495, 29.93219, 30.71604, 31.55034, 32.43930, 33.38748, 34.39981, &
        24.42606, 24.82551, 25.24441, 25.68404, 26.14579, 26.63117, 27.14183, 27.67951, 28.24617, 28.84389, 29.47494, 30.14179, 30.84712, 31.59385, 32.38511, 33.22432, 34.11513, 35.06149, 36.06763, 37.13801, &
        26.23833, 26.66994, 27.12215, 27.59629, 28.09378, 28.61614, 29.16504, 29.74224, 30.34970, 30.98947, 31.66382, 32.37515, 33.12607, 33.91938, 34.75808, 35.64537, 36.58467, 37.57959, 38.63395, 39.75168, &
        28.02178, 28.48356, 28.96693, 29.47324, 30.00389, 30.56044, 31.14452, 31.75791, 32.40250, 33.08033, 33.79359, 34.54459, 35.33583, 36.16994, 37.04976, 37.97823, 38.95846, 39.99371, 41.08733, 42.24277, &
        29.77498, 30.26491, 30.77725, 31.31333, 31.87458, 32.46250, 33.07871, 33.72496, 34.40308, 35.11503, 35.86291, 36.64892, 37.47541, 38.34484, 39.25979, 40.22297, 41.23715, 42.30521, 43.43006, 44.61459, &
        31.49671, 32.01275, 32.55186, 33.11535, 33.70461, 34.32112, 34.96646, 35.64231, 36.35043, 37.09269, 37.87107, 38.68765, 39.54457, 40.44414, 41.38867, 42.38058, 43.42234, 44.51645, 45.66536, 46.87149, &
        33.18600, 33.72613, 34.28982, 34.87836, 35.49310, 36.13547, 36.80701, 37.50930, 38.24402, 39.01294, 39.81790, 40.66083, 41.54370, 42.46858, 43.43757, 44.45281, 45.51642, 46.63053, 47.79722, 49.01846  &
       /), (/ nj, ni/) )
   real,   parameter :: lat_ref(nj,ni) =  reshape( (/ &
        49.78225, 50.81057, 51.83837, 52.86544, 53.89156, 54.91650, 55.94002, 56.96188, 57.98184, 58.99963, 60.01497, 61.02758, 62.03714, 63.04333, 64.04579, 65.04414, 66.03793, 67.02670, 68.00991, 68.98695, &
        49.90391, 50.93571, 51.96721, 52.99819, 54.02849, 55.05788, 56.08616, 57.11313, 58.13857, 59.16225, 60.18395, 61.20343, 62.22046, 63.23476, 64.24606, 65.25406, 66.25847, 67.25893, 68.25504, 69.24640, &
        49.99207, 51.02641, 52.06060, 53.09446, 54.12781, 55.16047, 56.19225, 57.22296, 58.25243, 59.28045, 60.30684, 61.33140, 62.35394, 63.37424, 64.39211, 65.40733, 66.41966, 67.42887, 68.43470, 69.43689, &
        50.04642, 51.08233, 52.11820, 53.15384, 54.18909, 55.22377, 56.25772, 57.29077, 58.32274, 59.35347, 60.38278, 61.41051, 62.43650, 63.46057, 64.48256, 65.50230, 66.51962, 67.53436, 68.54634, 69.55539, &
        50.06676, 51.10327, 52.13976, 53.17607, 54.21203, 55.24747, 56.28224, 57.31617, 58.34908, 59.38083, 60.41124, 61.44017, 62.46746, 63.49295, 64.51649, 65.53794, 66.55716, 67.57398, 68.58830, 69.59996, &
        50.05303, 51.08913, 52.12520, 53.16106, 54.19654, 55.23147, 56.26569, 57.29902, 58.33129, 59.36235, 60.39202, 61.42015, 62.44656, 63.47108, 64.49358, 65.51387, 66.53180, 67.54722, 68.55995, 69.56985, &
        50.00526, 51.03999, 52.07458, 53.10887, 54.14268, 55.17583, 56.20813, 57.23941, 58.26948, 59.29816, 60.32526, 61.35058, 62.37396, 63.39517, 64.41403, 65.43034, 66.44388, 67.45442, 68.46173, 69.46557, &
        49.92364, 50.95600, 51.98809, 53.01973, 54.05070, 55.08083, 56.10989, 57.13769, 58.16402, 59.18867, 60.21141, 61.23203, 62.25027, 63.26590, 64.27866, 65.28827, 66.29443, 67.29682, 68.29509, 69.28883, &
        49.80844, 50.83751, 51.86610, 52.89401, 53.92102, 54.94692, 55.97146, 56.99442, 58.01554, 59.03459, 60.05129, 61.06536, 62.07652, 63.08443, 64.08878, 65.08918, 66.08523, 67.07647, 68.06242, 69.04247, &
        49.66007, 50.68493, 51.70907, 52.73225, 53.75422, 54.77474, 55.79355, 56.81037, 57.82491, 58.83689, 59.84597, 60.85182, 61.85408, 62.85234, 63.84617, 64.83511, 65.81862, 66.79610, 67.76688, 68.73021, &
        49.47903, 50.49883, 51.51761, 52.53510, 53.55102, 54.56510, 55.57705, 56.58652, 57.59322, 58.59678, 59.59681, 60.59291, 61.58464, 62.57153, 63.55303, 64.52856, 65.49746, 66.45899, 67.41231, 68.35646, &
        49.26594, 50.27987, 51.29243, 52.30334, 53.31228, 54.31894, 55.32298, 56.32404, 57.32173, 58.31566, 59.30537, 60.29040, 61.27021, 62.24424, 63.21186, 64.17236, 65.12498, 66.06881, 67.00289, 67.92606, &
        49.02148, 50.02879, 51.03436, 52.03787, 53.03898, 54.03733, 55.03254, 56.02420, 57.01189, 57.99513, 58.97343, 59.94623, 60.91293, 61.87289, 62.82537, 63.76959, 64.70463, 65.62949, 66.54306, 67.44405, &
        48.74643, 49.74645, 50.74432, 51.73970, 52.73220, 53.72145, 54.70701, 55.68844, 56.66524, 57.63690, 58.60286, 59.56249, 60.51514, 61.46007, 62.39647, 63.32344, 64.24001, 65.14503, 66.03733, 66.91549, &
        48.44164, 49.43374, 50.42327, 51.40987, 52.39311, 53.37257, 54.34777, 55.31824, 56.28343, 57.24277, 58.19565, 59.14138, 60.07925, 61.00843, 61.92807, 62.83718, 63.73470, 64.61945, 65.49012, 66.34528, &
        48.10798, 49.09163, 50.07228, 51.04953, 52.02292, 52.99201, 53.95628, 54.91520, 55.86818, 56.81462, 57.75385, 58.68513, 59.60769, 60.52066, 61.42311, 62.31401, 63.19224, 64.05657, 64.90565, 65.73801, &
        47.74643, 48.72114, 49.69243, 50.65984, 51.62292, 52.58115, 53.53400, 54.48090, 55.42123, 56.35434, 57.27951, 58.19598, 59.10291, 59.99939, 60.88447, 61.75706, 62.61603, 63.46009, 64.28790, 65.09798, &
        47.35793, 48.32331, 49.28483, 50.24202, 51.19439, 52.14138, 53.08245, 54.01698, 54.94434, 55.86382, 56.77467, 57.67611, 58.56726, 59.44720, 60.31491, 61.16932, 62.00925, 62.83343, 63.64052, 64.42907, &
        46.94349, 47.89921, 48.85065, 49.79729, 50.73864, 51.67411, 52.60313, 53.52506, 54.43923, 55.34491, 56.24134, 57.12769, 58.00306, 58.86653, 59.71706, 60.55356, 61.37487, 62.17975, 62.96684, 63.73476, &
        46.50412, 47.44992, 48.39101, 49.32689, 50.25698, 51.18074, 52.09754, 53.00673, 53.90760, 54.79944, 55.68143, 56.55275, 57.41250, 58.25971, 59.09338, 59.91240, 60.71566, 61.50190, 62.26986, 63.01817  &
       /), (/ nj, ni /))

   do i = 1, 20
      do j = 1, nj
         x = (i-4) * 141.3 
         y = (j+1) * 115.3 
         call amc2geo_bis(x, y, lons(j), lats(j), its(j))
         call assertEqual( (/lons(j),lats(j)/), (/lon_ref(j,i),lat_ref(j,i)/), 30e-3, 'amc2geo-ref')

         call amc2geo(x, y, lon, lat)
         call assertEqual( (/lons(j),lats(j)/), (/lon,lat/), 4.0, 'amc2geo-amc2geo-bis')

         call geo2amc(lats(j),lons(j),x1,y1)
         call assertEqual( (/x,y/), (/x1,y1/), 10e-3, 'amc2geo-geo2amc')

         call amc2lam_bis(x, y, xlam(j), ylam(j))
         call assertEqual( (/xlam(j),ylam(j)/), (/xlam_ref(j,i),ylam_ref(j,i)/), 30e-3, 'amc2lam-ref')
         call amc2lam(x, y, x1, y1)
         call assertEqual( (/xlam(j),ylam(j)/), (/xlam_ref(j,i),ylam_ref(j,i)/), 4.0, 'amc2lam-amclam-bis')
         call geo2lam(lats(j),lons(j),x2,y2)
         call assertEqual( (/x2,y2/), (/xlam(j),ylam(j)/), 30e-3, 'amc2lam = geo2lam')
      end do
      print fmt, 'lons = ',lons
      print fmt, 'lats = ',lats
      print fmt, 'xlam = ',xlam
      print fmt, 'ylam = ',ylam
      print fmt, 'its = ',its
   end do
   call conclusion()
end program test_geom

